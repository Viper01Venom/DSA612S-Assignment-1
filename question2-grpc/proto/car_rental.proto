syntax = "proto3";

package carrental;

// --- Messages ---

message Context {
  string user_id = 1;
}

message Car {
  string plate = 1;
  string make = 2;
  string model = 3;
  int32 year = 4;
  double daily_price = 5;
  int32 mileage = 6;
  string status = 7; // "AVAILABLE", "UNAVAILABLE", "RENTED"
  Context context = 8;
}

message User {
  string id = 1;
  string name = 2;
  string role = 3;   // "ADMIN" or "CUSTOMER"
  string email = 4;
}

message CarResponse {
  Car car = 1;
  string message = 2;
}

message CreateUsersResponse {
  string message = 1;
}

message RemoveCarRequest {
  string plate = 1;
  Context context = 2;
}

message ListAvailableRequest {
  Context context = 1;
}

message SearchCarRequest {
  string plate = 1;
  Context context = 2;
}

message CartItem {
  string user_id = 1;
  string plate = 2;
  string start_date = 3;
  string end_date = 4;
}

message StatusResponse {
  string message = 1;
}

message PlaceReservationRequest {
  string user_id = 1;
}

message Reservation {
  string id = 1;
  string user_id = 2;
  repeated CartItem items = 3;
  double total_price = 4;
}

message ReservationResponse {
  Reservation reservation = 1;
  string message = 2;
}

// --- Service ---

service CarRentalService {
  rpc add_car(Car) returns (CarResponse);
  rpc update_car(Car) returns (CarResponse);
  rpc remove_car(RemoveCarRequest) returns (stream Car);

  rpc create_users(stream User) returns (CreateUsersResponse);

  rpc list_available_cars(ListAvailableRequest) returns (stream Car);
  rpc search_car(SearchCarRequest) returns (CarResponse);

  rpc add_to_cart(CartItem) returns (StatusResponse);
  rpc place_reservation(PlaceReservationRequest) returns (ReservationResponse);
}
